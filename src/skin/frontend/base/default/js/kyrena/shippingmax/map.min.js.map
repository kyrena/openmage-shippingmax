{"version":3,"sources":["map.js"],"sourcesContent":["/**\n * Created V/12/04/2019\n * Updated J/02/02/2023\n *\n * Copyright 2019-2023 | Fabrice Creuzot <fabrice~cellublue~com>\n * Copyright 2019-2023 | Mickaël Vang <mickael~cellublue~com>\n * https://github.com/kyrena/openmage-shippingmax\n *\n * This program is free software, you can redistribute it or modify\n * it under the terms of the GNU General Public License (GPL) as published\n * by the free software foundation, either version 2 of the license, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but without any warranty, without even the implied warranty of\n * merchantability or fitness for a particular purpose. See the\n * GNU General Public License (GPL) for more details.\n */\n\nif (window.NodeList && !NodeList.prototype.forEach) {\n\tNodeList.prototype.forEach = function (callback, that, i) {\n\t\tthat = that || window;\n\t\tfor (i = 0; i < this.length; i++)\n\t\t\tcallback.call(that, this[i], i, this);\n\t};\n}\n\nvar shippingmax = new (function () {\n\n\t\"use strict\";\n\tthis.showList = false; // select country\n\tthis.showAll  = false; // storelocator\n\n\t// base\n\n\tthis.init = function () {\n\n\t\tconsole.info('shippingmax.map - hello');\n\n\t\t// crée les fonds de carte\n\t\t// @see Kyrena_Shippingmax_Model_Source_Maps\n\t\tvar elem, maps = {},\n\t\t    igncopy = '<a href=\"https://www.ign.fr/\" target=\"_blank\">IGN France<\\/a>',\n\t\t    osmcopy = '<a href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\">Open Street Map<\\/a>',\n\t\t    ggmcopy = '<a href=\"https://www.google.com/maps\" target=\"_blank\">Google<\\/a>',\n\t\t    config = {\n\t\t\tign: self.ignkey ? L.tileLayer('https://wxs.ign.fr/' + self.ignkey + '/geoportail/wmts?&request=GetTile&service=WMTS' +\n\t\t\t\t'&version=1.0.0&style=normal&tilematrixset=PM&format=image/jpeg&layer=GEOGRAPHICALGRIDSYSTEMS.MAPS' +\n\t\t\t\t'&tilematrix={z}&tilerow={y}&tilecol={x}', {\n\t\t\t\tattribution: igncopy,\n\t\t\t\tname: 'IGN France',\n\t\t\t\tminZoom: 4,\n\t\t\t\tmaxZoom: 18,\n\t\t\t\ttileSize: 256,\n\t\t\t\tdetectRetina: true\n\t\t\t}) : null,\n\t\t\tignst: self.ignkey ? L.tileLayer('https://wxs.ign.fr/' + self.ignkey + '/geoportail/wmts?&request=GetTile&service=WMTS' +\n\t\t\t\t'&version=1.0.0&style=normal&tilematrixset=PM&format=image/jpeg&layer=ORTHOIMAGERY.ORTHOPHOTOS' +\n\t\t\t\t'&tilematrix={z}&tilerow={y}&tilecol={x}', {\n\t\t\t\tattribution: igncopy,\n\t\t\t\tname: 'IGN Sat France',\n\t\t\t\tminZoom: 4,\n\t\t\t\tmaxZoom: 18,\n\t\t\t\ttileSize: 256,\n\t\t\t\tdetectRetina: true\n\t\t\t}) : null,\n\t\t\tosm: L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n\t\t\t\tattribution: osmcopy,\n\t\t\t\tname: 'Open Street Map',\n\t\t\t\tminZoom: 4,\n\t\t\t\tmaxZoom: 19,\n\t\t\t\tdetectRetina: true\n\t\t\t}),\n\t\t\tosmfr: L.tileLayer('https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {\n\t\t\t\tattribution: osmcopy,\n\t\t\t\tname: 'Open Street Map France',\n\t\t\t\tminZoom: 4,\n\t\t\t\tmaxZoom: 19,\n\t\t\t\tdetectRetina: true\n\t\t\t}),\n\t\t\tosmde: L.tileLayer('https://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png', {\n\t\t\t\tattribution: osmcopy,\n\t\t\t\tname: 'Open Street Map Deutschland',\n\t\t\t\tminZoom: 4,\n\t\t\t\tmaxZoom: 19,\n\t\t\t\tdetectRetina: true\n\t\t\t}),\n\t\t\tosmbre: L.tileLayer('https://tile.openstreetmap.bzh/br/{z}/{x}/{y}.png', {\n\t\t\t\tattribution: osmcopy,\n\t\t\t\tname: 'Open Street Map Brezhoneg',\n\t\t\t\tminZoom: 4,\n\t\t\t\tmaxZoom: 19,\n\t\t\t\tdetectRetina: true\n\t\t\t}),\n\t\t\tosmoci: L.tileLayer('https://tile.openstreetmap.bzh/oc/{z}/{x}/{y}.png', {\n\t\t\t\tattribution: osmcopy,\n\t\t\t\tname: 'Open Street Map Occitan',\n\t\t\t\tminZoom: 4,\n\t\t\t\tmaxZoom: 19,\n\t\t\t\tdetectRetina: true\n\t\t\t}),\n\t\t\tosmeus: L.tileLayer('https://tile.openstreetmap.bzh/eu/{z}/{x}/{y}.png', {\n\t\t\t\tattribution: osmcopy,\n\t\t\t\tname: 'Open Street Map Euskara',\n\t\t\t\tminZoom: 4,\n\t\t\t\tmaxZoom: 19,\n\t\t\t\tdetectRetina: true\n\t\t\t}),\n\t\t\tosmbot: L.tileLayer('https://{s}.tile.openstreetmap.fr/openriverboatmap/{z}/{x}/{y}.png', {\n\t\t\t\tattribution: osmcopy,\n\t\t\t\tname: 'Open Street Map Boat',\n\t\t\t\tminZoom: 4,\n\t\t\t\tmaxZoom: 19,\n\t\t\t\tdetectRetina: true\n\t\t\t}),\n\t\t\tocm: L.tileLayer('https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png', {\n\t\t\t\tattribution: '<a href=\"https://github.com/cyclosm/cyclosm-cartocss-style\" target=\"_blank\">CyclOSM<\\/a>',\n\t\t\t\tname: 'Open Cyclo Map',\n\t\t\t\tminZoom: 4,\n\t\t\t\tmaxZoom: 19,\n\t\t\t\tdetectRetina: true\n\t\t\t}),\n\t\t\totm: L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {\n\t\t\t\tattribution: osmcopy,\n\t\t\t\tname: 'Open Topo Map',\n\t\t\t\tminZoom: 4,\n\t\t\t\tmaxZoom: 19,\n\t\t\t\tdetectRetina: true\n\t\t\t}),\n\t\t\tchm: L.tileLayer('https://wmts.geo.admin.ch/1.0.0/ch.swisstopo.pixelkarte-farbe/default/current/3857/{z}/{x}/{y}.jpeg', {\n\t\t\t\tattribution: '<a href=\"https://www.swisstopo.admin.ch/\" target=\"_blank\">Swisstopo<\\/a>',\n\t\t\t\tname: 'Swiss Topo Map',\n\t\t\t\tminZoom: 4,\n\t\t\t\tmaxZoom: 19,\n\t\t\t\tdetectRetina: true\n\t\t\t}),\n\t\t\tggm: L.tileLayer('https://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {\n\t\t\t\tsubdomains: ['mt0', 'mt1', 'mt2', 'mt3'],\n\t\t\t\tattribution: ggmcopy,\n\t\t\t\tname: 'Google Map',\n\t\t\t\tminZoom: 4,\n\t\t\t\tmaxZoom: 19,\n\t\t\t\tdetectRetina: true\n\t\t\t}),\n\t\t\tggmst: L.tileLayer('httpS://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {\n\t\t\t\tsubdomains: ['mt0', 'mt1', 'mt2', 'mt3'],\n\t\t\t\tattribution: ggmcopy,\n\t\t\t\tname: 'Google Map Sat',\n\t\t\t\tminZoom: 4,\n\t\t\t\tmaxZoom: 19,\n\t\t\t\tdetectRetina: true\n\t\t\t})\n\t\t};\n\n\t\tfor (elem in config) if (config.hasOwnProperty(elem)) {\n\t\t\tif (config[elem] && config[elem].options.name) {\n\t\t\t\tconfig[elem].options.attribution += ' ' + self.browser;\n\t\t\t\tmaps[config[elem].options.name] = config[elem];\n\t\t\t}\n\t\t}\n\n\t\tif (!config[self.defmap] || (self.defmap === 'ggm') && (['yes', '1', 1].indexOf(navigator.doNotTrack) > -1))\n\t\t\tself.defmap = 'osm';\n\n\t\t// pour IOS pour autoriser le scroll dans l'object (ex-iframe)\n\t\tif (navigator.userAgent.match(/iPhone/i))\n\t\t\tthis.qs('html').classList.add('iphone');\n\n\t\t// pour Edge 14 qui laisse le loader affiché (ajoute une classe sans css)\n\t\t// ajoute aussi une classe à html pour faire la différence entre un onglet et une popin\n\t\telem = self.parent.document.getElementById('shippingmaxBox');\n\t\tif (elem) {\n\t\t\telem.classList.add('hack');\n\t\t\tthis.qs('html').classList.add('popin');\n\t\t}\n\n\t\t// crée la carte avec les marqueurs\n\t\tself.grp = new L.featureGroup();\n\t\tself.map = L.map('map', { layers: [config[self.defmap], self.grp], scrollWheelZoom: true, doubleRightClickZoom: true });\n\t\tL.control.layers(maps).addTo(self.map);\n\t\tL.control.scale({ imperial: false }).addTo(self.map);\n\t\tthis.createMarkers();\n\n\t\t// boutons plein écran @todo\n\t\t// sauf pour la carte d'une commande (.alone)\n\t\tif (!this.qs('.alone')) {\n\n\t\t\tL.Control.Bigmap = L.Control.extend({\n\t\t\t\toptions: { position: 'topleft' },\n\t\t\t\tonAdd: function (map) {\n\t\t\t\t\tvar elem  = L.DomUtil.create('div', 'leaflet-control-fullscreen leaflet-bar leaflet-control');\n\t\t\t\t\tthis.link = L.DomUtil.create('a', 'leaflet-control-fullscreen-button leaflet-bar-part', elem);\n\t\t\t\t\tthis.link.href = '';\n\t\t\t\t\tthis._map = map;\n\t\t\t\t\tL.DomEvent.disableClickPropagation(this.link);\n\t\t\t\t\tL.DomEvent.on(this.link, 'click', this.action, this);\n\t\t\t\t\treturn elem;\n\t\t\t\t},\n\t\t\t\taction: function (ev) {\n\t\t\t\t\tL.DomEvent.stop(ev);\n\t\t\t\t\tif (ev.detail == 1) {\n\t\t\t\t\t\tvar btn = this.getContainer().classList, that = shippingmax, div = that.qs('body').classList;\n\t\t\t\t\t\tif (btn.contains('leaflet-fullscreen-on')) {\n\t\t\t\t\t\t\tbtn.remove('leaflet-fullscreen-on');\n\t\t\t\t\t\t\tdiv.remove('full-map');\n\t\t\t\t\t\t\tthis._map.invalidateSize();\n\t\t\t\t\t\t\tif (div = that.qs('.item.clicked, .item.selected')) {\n\t\t\t\t\t\t\t\tthat.goToMarkerFromDetails({ target: { nodeName: 'fullscreenquit' } }, div);\n\t\t\t\t\t\t\t\tthat.scrollToDetails(div);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tbtn.add('leaflet-fullscreen-on');\n\t\t\t\t\t\t\tdiv.add('full-map');\n\t\t\t\t\t\t\tthis._map.invalidateSize();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tself.map.addControl(new L.Control.Bigmap());\n\n\t\t\tL.Control.Hidemap = L.Control.extend({\n\t\t\t\toptions: { position: 'topright' },\n\t\t\t\tonAdd: function (map) {\n\t\t\t\t\tvar elem  = L.DomUtil.create('div', 'leaflet-control-hidemap leaflet-bar leaflet-control close hide');\n\t\t\t\t\tthis.link = L.DomUtil.create('a', 'leaflet-control-hidemap-button leaflet-bar-part', elem);\n\t\t\t\t\tthis.link.href = '';\n\t\t\t\t\tthis._map = map;\n\t\t\t\t\tL.DomEvent.disableClickPropagation(this.link);\n\t\t\t\t\tL.DomEvent.on(this.link, 'click', this.action, this);\n\t\t\t\t\treturn elem;\n\t\t\t\t},\n\t\t\t\taction: function (ev) {\n\t\t\t\t\tL.DomEvent.stop(ev);\n\t\t\t\t\tif (ev.detail == 1) {\n\t\t\t\t\t\tvar btn = this.getContainer().classList, that = shippingmax, div = that.qs('body').classList;\n\t\t\t\t\t\tif (btn.contains('leaflet-hidemap-on')) {\n\t\t\t\t\t\t\tbtn.remove('leaflet-hidemap-on');\n\t\t\t\t\t\t\tdiv.remove('hide-map');\n\t\t\t\t\t\t\tthat.qs('.leaflet-top.leaflet-right').appendChild(this.getContainer());\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tbtn.add('leaflet-hidemap-on');\n\t\t\t\t\t\t\tdiv.add('hide-map');\n\t\t\t\t\t\t\tthat.qs('body').appendChild(this.getContainer());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tself.map.addControl(new L.Control.Hidemap());\n\t\t}\n\n\t\t// ferme la carte avec la touche échap\n\t\tif ((self != self.parent) && (typeof self.parent.shippingmax == 'object') && (typeof self.parent.shippingmax.keyClose == 'function'))\n\t\t\tdocument.addEventListener('keydown', self.parent.shippingmax.keyClose);\n\t};\n\n\tthis.createMarkers = function () {\n\n\t\tvar elem, mkr, key, nb = Object.keys(self.data).length;\n\t\tself.grp.clearLayers();\n\n\t\tif (nb > 0) {\n\n\t\t\tthis.qs('body').classList.remove('empty');\n\n\t\t\t// crée les marqueurs des lieux de livraison\n\t\t\t// traitement spécial pour la carte d'une commande (.alone)\n\t\t\tfor (key in self.data) if (self.data.hasOwnProperty(key)) {\n\n\t\t\t\tmkr = self.data[key];\n\t\t\t\tmkr = L.marker([mkr.lat, mkr.lng], {\n\t\t\t\t\ttitle: mkr.name,\n\t\t\t\t\tshadowUrl: null,\n\t\t\t\t\tshadowRetinaUrl: null,\n\t\t\t\t\tshadowSize: null,\n\t\t\t\t\tshadowAnchor: null\n\t\t\t\t}).addTo(self.grp);\n\n\t\t\t\tmkr.on('click', (nb > 1) ? shippingmax.goToDetailsFromMarker : L.DomEvent.stop);\n\t\t\t\tmkr.on('dblclick', L.DomEvent.stop);\n\t\t\t\tmkr.htmlId = key;\n\n\t\t\t\tself.data[key].leaflet = mkr;\n\t\t\t}\n\n\t\t\t// crée le marqueur position\n\t\t\t// si les coordonnées sont définies\n\t\t\tif ((self.marklat != 0) && (self.marklng != 0)) {\n\n\t\t\t\tL.marker([self.marklat, self.marklng], {\n\t\t\t\t\ticon: L.icon({\n\t\t\t\t\t\ticonUrl: L.Icon.Default.prototype._getIconUrl().replace('undefined', 'ic-user-map.svg'),\n\t\t\t\t\t\ticonSize: [26, 40],\n\t\t\t\t\t\ticonAnchor: [13, 25],\n\t\t\t\t\t\tshadowUrl: null,\n\t\t\t\t\t\tshadowRetinaUrl: null,\n\t\t\t\t\t\tshadowSize: null,\n\t\t\t\t\t\tshadowAnchor: null,\n\t\t\t\t\t\tclassName: 'userpos'\n\t\t\t\t\t})\n\t\t\t\t}).addTo(self.grp);\n\t\t\t}\n\n\t\t\t// centre la carte\n\t\t\t// traitement spécial pour la carte d'une commande (.alone) et le storelocator\n\t\t\telem = this.qs('#postcode');\n\t\t\tif (!elem || (elem.value.length > 0))\n\t\t\t\tself.map.fitBounds(self.grp.getBounds(), { maxZoom: 15 });\n\t\t\telse\n\t\t\t\tself.map.setView([46.76, 2.42], 6); // France @todo\n\n\t\t\t// marque l'éventuel point de livraison sélectionné\n\t\t\telem = this.qs('.item.selected');\n\t\t\tif (elem) {\n\t\t\t\tmkr = self.data[elem.getAttribute('id').slice(2)].leaflet;\n\t\t\t\tmkr.getElement().classList.add('selected');\n\t\t\t\tthis.goToDetailsFromMarker({ target: mkr, move: false });\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tthis.qs('body').classList.add('empty');\n\t\t}\n\n\t\treturn nb;\n\t};\n\n\tthis.stopScrollFromFixed = function (ev) {\n\n\t\tvar elem = ev.target;\n\t\twhile (elem.parentNode && (elem.nodeName !== 'BODY')) {\n\t\t\tif (elem.classList.contains('leaflet-control-layers-scrollbar')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (elem.classList.contains('map') || elem.classList.contains('top')) {\n\t\t\t\tev.preventDefault();\n\t\t\t\tev.stopPropagation();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telem = elem.parentNode;\n\t\t}\n\t};\n\n\tthis.closeMap = function () {\n\n\t\tif (typeof self.parent.shippingmax.close == 'function')\n\t\t\tself.parent.shippingmax.close(true);\n\t\telse\n\t\t\tself.close();\n\t};\n\n\tthis.qs = function (selector) {\n\t\treturn document.querySelector(selector);\n\t};\n\n\t// méthodes inutiles pour la carte d'une commande (.alone)\n\n\tthis.askGeoloc = function () {\n\n\t\tif (navigator.geolocation) {\n\n\t\t\tvar that = shippingmax, loader = document.getElementById('loader').classList;\n\t\t\tloader.add('show');\n\n\t\t\tnavigator.geolocation.getCurrentPosition(function (pos) {\n\t\t\t\tthat.submitFormAjax(that.qs('form.search'), pos.coords.latitude, pos.coords.longitude, true);\n\t\t\t}, function (err) {\n\t\t\t\tloader.remove('show');\n\t\t\t\tconsole.warn(err);\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\tthis.qs('.btn-geoloc').classList.add('hide');\n\t\t}\n\t};\n\n\tthis.submitFormAjax = function (form, lat, lng, ignore) {\n\n\t\tvar data, xhr, that = shippingmax, showAll = that.showAll, loader = document.getElementById('loader').classList;\n\n\t\t// n'est pas un button en mobile\n\t\t// ce qui fait qu'on est obligé d'utiliser showAll pour déterminer quel bouton submit est utilisé\n\t\tdocument.activeElement.blur();\n\n\t\tif ((ignore !== true) && loader.contains('show'))\n\t\t\treturn false;\n\n\t\ttry {\n\t\t\tloader.add('show');\n\t\t\txhr = new XMLHttpRequest();\n\n\t\t\t// soit l'utilisateur a cliqué sur le bouton afficher tout (btn-show-all), donc en get\n\t\t\t// soit l'utilisateur a cliqué sur le bouton géolocalisation (btn-geoloc), donc transmet les coordonnées\n\t\t\t// soit l'utilisateur a fait une recherche ou a sélectionné un lieu, donc transmet les données du bon formulaire\n\t\t\tif (showAll) {\n\t\t\t\tthat.showAll = false;\n\t\t\t\txhr.open('GET', form.action + '?isAjax=true', true);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tdata = that.serializeForm(form);\n\t\t\t\tif ((typeof lat == 'number') && (typeof lng == 'number'))\n\t\t\t\t\tdata += '&lat=' + lat + '&lng=' + lng + '&geoloc=1';\n\n\t\t\t\txhr.open('POST', (data.indexOf('id=') > -1) ? form.action + '?isAjax=true&' + data : form.action + '?isAjax=true', true);\n\t\t\t\txhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n\t\t\t}\n\n\t\t\txhr.onreadystatechange = function () {\n\n\t\t\t\tif ((xhr.readyState === 4) && ((xhr.status === 200) || (xhr.status === 0))) {\n\n\t\t\t\t\tvar elem, subelem, json, mkr;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tjson = JSON.parse(xhr.responseText);\n\n\t\t\t\t\t\tif (json.status && json.maplist) {\n\n\t\t\t\t\t\t\tself.scroll(0, 0);\n\n\t\t\t\t\t\t\t// update list\n\t\t\t\t\t\t\tthat.qs('form.results').innerHTML = json.maplist;\n\n\t\t\t\t\t\t\tself.data    = json.items; // (array)\n\t\t\t\t\t\t\tself.marklat = json.lat;   // (float)\n\t\t\t\t\t\t\tself.marklng = json.lng;   // (float)\n\n\t\t\t\t\t\t\t// sélectionne le bon pays\n\t\t\t\t\t\t\tif (json.country && (elem = that.qs('.country-choice input[value=\"' + json.country.toUpperCase() + '\"]'))) {\n\t\t\t\t\t\t\t\tif (subelem = that.qs('.country-choice input[checked]'))\n\t\t\t\t\t\t\t\t\tsubelem.removeAttribute('checked');\n\t\t\t\t\t\t\t\tif (subelem = that.qs('.country-choice input:checked'))\n\t\t\t\t\t\t\t\t\tsubelem.checked = false;\n\t\t\t\t\t\t\t\telem.checked = true;\n\t\t\t\t\t\t\t\telem.setAttribute('checked', 'checked');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (showAll || json.postcode)\n\t\t\t\t\t\t\t\tdocument.getElementById('postcode').value = json.postcode || '';\n\t\t\t\t\t\t\tif (showAll || json.city)\n\t\t\t\t\t\t\t\tdocument.getElementById('city').value = json.city || '';\n\n\t\t\t\t\t\t\tthat.createMarkers();\n\t\t\t\t\t\t\tloader.remove('show');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (json.status) {\n\t\t\t\t\t\t\t// parent save qui va fermer la carte\n\t\t\t\t\t\t\t// lorsque la carte est ouverte dans un object\n\t\t\t\t\t\t\tif (typeof self.parent.shippingmax.show == 'function') {\n\t\t\t\t\t\t\t\tself.parent.shippingmax.show(json);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// marque et centre le point de livraison sélectionné\n\t\t\t\t\t\t\t// lorsque la carte est ouverte dans un nouvel onglet\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tthat.resetMarkers(true);\n\t\t\t\t\t\t\t\tmkr = self.data[json.id].leaflet;\n\t\t\t\t\t\t\t\tmkr.getElement().classList.add('selected');\n\t\t\t\t\t\t\t\tself.map.setView(mkr.getLatLng(), 15);\n\t\t\t\t\t\t\t\tdocument.getElementById('pt' + json.id).classList.add('selected', 'clicked');\n\t\t\t\t\t\t\t\tloader.remove('show');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (json.error) {\n\t\t\t\t\t\t\t// error\n\t\t\t\t\t\t\tif (json.error === 'refresh') {\n\t\t\t\t\t\t\t\tself.location.reload();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\talert(json.error);\n\t\t\t\t\t\t\t\tloader.remove('show');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t// error\n\t\t\t\t\t\t\talert(json);\n\t\t\t\t\t\t\tloader.remove('show');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\tconsole.error(e, xhr.responseText); // SyntaxError: Unexpected end of JSON input\n\t\t\t\t\t\tself.location.reload();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\txhr.send(data);\n\t\t\treturn false;\n\t\t}\n\t\tcatch (e) {\n\t\t\tconsole.error(e);\n\t\t\tloader.remove('show');\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tthis.serializeForm = function (form) {\n\n\t\tvar data = [];\n\n\t\tArray.prototype.forEach.call(form.elements, function (elem) {\n\n\t\t\tif (elem.nodeName === 'INPUT') {\n\t\t\t\tif (['checkbox', 'radio'].indexOf(elem.getAttribute('type')) > -1) {\n\t\t\t\t\tif (elem.checked)\n\t\t\t\t\t\tdata.push(elem.name + '=' + encodeURIComponent(elem.value));\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tdata.push(elem.name + '=' + encodeURIComponent(elem.value));\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (elem.nodeName === 'SELECT') {\n\t\t\t\tdata.push(elem.name + '=' + encodeURIComponent(elem.value));\n\t\t\t}\n\t\t});\n\n\t\treturn data.join('&');\n\t};\n\n\tthis.goToDetailsFromMarker = function (ev) {\n\n\t\t// activeElement n'est pas un button en mobile\n\t\t// ne fait rien si submitFormAjax est en cours ou s'il va commencer\n\t\tif ((ev.target.nodeName === 'BUTTON') || (document.activeElement && (document.activeElement.nodeName === 'BUTTON')))\n\t\t\treturn;\n\n\t\t// elem = li.item, css = mkr\n\t\tvar that = shippingmax, mkr = ev.target, css = mkr.getElement().classList, already = css.contains('clicked');\n\t\tthat.resetMarkers();\n\n\t\t// désélectionne, ou sélectionne et centre la carte et centre la liste\n\t\tif (already) {\n\t\t\tcss.remove('clicked');\n\t\t}\n\t\telse {\n\t\t\tvar elem = document.getElementById('pt' + mkr.htmlId);\n\t\t\tif (ev.move !== false) {\n\t\t\t\tcss.add('clicked');\n\t\t\t\telem.classList.add('clicked');\n\t\t\t\tself.map.setView(mkr.getLatLng());\n\t\t\t}\n\t\t\tthat.scrollToDetails(elem);\n\t\t}\n\t};\n\n\tthis.goToMarkerFromDetails = function (ev, elem) {\n\n\t\t// activeElement n'est pas un button en mobile\n\t\t// ne fait rien si submitFormAjax est en cours ou s'il va commencer\n\t\tif ((ev.target.nodeName === 'BUTTON') || (document.activeElement && (document.activeElement.nodeName === 'BUTTON')))\n\t\t\treturn;\n\n\t\t// css et elem = li.item\n\t\tvar css = elem.classList, already = css.contains('clicked');\n\t\tthis.resetMarkers();\n\n\t\t// désélectionne, ou sélectionne et centre la carte\n\t\tif (already && !css.contains('selected') && (ev.target.nodeName !== 'fullscreenquit')) {\n\t\t\tcss.remove('clicked');\n\t\t}\n\t\telse {\n\t\t\tcss.add('clicked');\n\t\t\tvar mkr = self.data[elem.getAttribute('id').slice(2)].leaflet;\n\t\t\tmkr.getElement().classList.add('clicked');\n\t\t\tself.map.setView(mkr.getLatLng(), 15);\n\t\t}\n\t};\n\n\tthis.scrollToDetails = function (elem) {\n\n\t\t// pour IOS qui refuse de faire un scroll\n\t\tif (this.qs('html.iphone.popin')) {\n\t\t\tvar val = this.qs('.map').getBoundingClientRect().bottom + 5;\n\t\t\tthis.qs('.results-list').setAttribute('style', 'margin:-' + val + 'px 0 ' + val + 'px;');\n\t\t\telem.scrollIntoView({ block: 'start' });\n\t\t\tthis.qs('.results-list').removeAttribute('style');\n\t\t}\n\t\telse {\n\t\t\tself.scroll(0, (self.innerWidth < 768) ?\n\t\t\t\telem.offsetTop - parseInt(self.getComputedStyle(this.qs('.results')).paddingTop) - 5 :\n\t\t\t\telem.offsetTop - self.innerHeight / 2 + this.qs('.top').offsetHeight / 2 + elem.offsetHeight / 2\n\t\t\t);\n\t\t}\n\t};\n\n\tthis.resetMarkers = function (selected) {\n\t\tdocument.querySelectorAll('.clicked, .selected').forEach(function (elem) {\n\t\t\telem.classList.remove('clicked', selected ? 'selected' : 'nothing');\n\t\t});\n\t};\n\n\tthis.updateZipFromCountry = function (elem) {\n\t\tdocument.getElementById('postcode').setAttribute('type', (self.tel.indexOf(elem.value) < 0) ? 'text' : 'tel');\n\t\tif (elem.value == 'MC') {\n\t\t\tdocument.getElementById('postcode').value = '98000';\n\t\t\tdocument.getElementById('city').value = 'Monaco';\n\t\t}\n\t};\n\n\tthis.showSelect = function (action) {\n\t\taction = (action === false) ? 'remove' : ((this.showList = !this.showList) ? 'add' : 'remove');\n\t\tthis.qs('.search').classList[action]('country-select');\n\t\tthis.showList = action === 'add';\n\t};\n\n})();\n\nif (typeof self.addEventListener == 'function') {\n\tself.addEventListener('load', shippingmax.init.bind(shippingmax));\n\tself.addEventListener('DOMMouseScroll', shippingmax.stopScrollFromFixed, { passive: false });\n\tself.addEventListener('mousewheel', shippingmax.stopScrollFromFixed, { passive: false });\n\tself.addEventListener('touchmove', shippingmax.stopScrollFromFixed, { passive: false });\n}\n\n// instarelou\nfunction _AutofillCallbackHandler() { }\nfunction _pcmBridgeCallbackHandler() { }\nvar PaymentAutofillConfig = { };"],"names":["window","NodeList","prototype","forEach","callback","that","i","this","length","call","shippingmax","showList","showAll","init","console","info","elem","maps","igncopy","osmcopy","ggmcopy","config","ign","self","ignkey","L","tileLayer","attribution","name","minZoom","maxZoom","tileSize","detectRetina","ignst","osm","osmfr","osmde","osmbre","osmoci","osmeus","osmbot","ocm","otm","chm","ggm","subdomains","ggmst","hasOwnProperty","options","browser","defmap","indexOf","navigator","doNotTrack","userAgent","match","qs","classList","add","parent","document","getElementById","grp","featureGroup","map","layers","scrollWheelZoom","doubleRightClickZoom","control","addTo","scale","imperial","createMarkers","Control","Bigmap","extend","position","onAdd","DomUtil","create","link","href","_map","DomEvent","disableClickPropagation","on","action","ev","div","stop","detail","btn","getContainer","contains","remove","invalidateSize","goToMarkerFromDetails","target","nodeName","scrollToDetails","addControl","Hidemap","appendChild","keyClose","addEventListener","mkr","key","nb","Object","keys","data","clearLayers","marker","lat","lng","title","shadowUrl","shadowRetinaUrl","shadowSize","shadowAnchor","goToDetailsFromMarker","htmlId","leaflet","marklat","marklng","icon","iconUrl","Icon","Default","_getIconUrl","replace","iconSize","iconAnchor","className","value","fitBounds","getBounds","setView","getAttribute","slice","getElement","move","stopScrollFromFixed","parentNode","preventDefault","stopPropagation","closeMap","close","selector","querySelector","askGeoloc","loader","geolocation","getCurrentPosition","pos","submitFormAjax","coords","latitude","longitude","err","warn","form","ignore","xhr","activeElement","blur","XMLHttpRequest","open","serializeForm","setRequestHeader","onreadystatechange","subelem","json","readyState","status","JSON","parse","responseText","maplist","scroll","innerHTML","items","country","toUpperCase","removeAttribute","checked","setAttribute","postcode","city","show","resetMarkers","id","getLatLng","error","location","reload","alert","e","send","Array","elements","push","encodeURIComponent","join","css","already","val","getBoundingClientRect","bottom","scrollIntoView","block","innerWidth","offsetTop","parseInt","getComputedStyle","paddingTop","innerHeight","offsetHeight","selected","querySelectorAll","updateZipFromCountry","tel","showSelect","_AutofillCallbackHandler","_pcmBridgeCallbackHandler","bind","passive","PaymentAutofillConfig"],"mappings":"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"}