/*!
 * Copyright 2019-2023 | Fabrice Creuzot <fabrice~cellublue~com>
 * Copyright 2019-2023 | MickaÃ«l Vang <mickael~cellublue~com>
 * https://github.com/kyrena/openmage-shippingmax
 * This program is free software, you can redistribute it or modify
 * it under the terms of the GNU General Public License (GPL).
 */
window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t,o){for(t=t||window,o=0;o<this.length;o++)e.call(t,this[o],o,this)});var shippingmax=new function(){"use strict";this.show=!1,this.showAll=!1,this.init=function(){console.info("shippingmax.map - hello");var e,t={},o='<a href="https://www.ign.fr/" target="_blank">IGN France</a>',a='<a href="https://www.openstreetmap.org/copyright" target="_blank">Open Street Map</a>',s='<a href="https://www.google.com/maps" target="_blank">Google</a>',n={ign:self.ignkey?L.tileLayer("https://wxs.ign.fr/"+self.ignkey+"/geoportail/wmts?&request=GetTile&service=WMTS&version=1.0.0&style=normal&tilematrixset=PM&format=image/jpeg&layer=GEOGRAPHICALGRIDSYSTEMS.MAPS&tilematrix={z}&tilerow={y}&tilecol={x}",{attribution:o,name:"IGN France",minZoom:4,maxZoom:18,tileSize:256,detectRetina:!0}):null,ignst:self.ignkey?L.tileLayer("https://wxs.ign.fr/"+self.ignkey+"/geoportail/wmts?&request=GetTile&service=WMTS&version=1.0.0&style=normal&tilematrixset=PM&format=image/jpeg&layer=ORTHOIMAGERY.ORTHOPHOTOS&tilematrix={z}&tilerow={y}&tilecol={x}",{attribution:o,name:"IGN Sat France",minZoom:4,maxZoom:18,tileSize:256,detectRetina:!0}):null,osm:L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:a,name:"Open Street Map",minZoom:4,maxZoom:19,detectRetina:!0}),osmfr:L.tileLayer("https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png",{attribution:a,name:"Open Street Map France",minZoom:4,maxZoom:19,detectRetina:!0}),osmde:L.tileLayer("https://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png",{attribution:a,name:"Open Street Map Deutschland",minZoom:4,maxZoom:19,detectRetina:!0}),osmbre:L.tileLayer("https://tile.openstreetmap.bzh/br/{z}/{x}/{y}.png",{attribution:a,name:"Open Street Map Brezhoneg",minZoom:4,maxZoom:19,detectRetina:!0}),osmoci:L.tileLayer("https://tile.openstreetmap.bzh/oc/{z}/{x}/{y}.png",{attribution:a,name:"Open Street Map Occitan",minZoom:4,maxZoom:19,detectRetina:!0}),osmeus:L.tileLayer("https://tile.openstreetmap.bzh/eu/{z}/{x}/{y}.png",{attribution:a,name:"Open Street Map Euskara",minZoom:4,maxZoom:19,detectRetina:!0}),osmbot:L.tileLayer("https://{s}.tile.openstreetmap.fr/openriverboatmap/{z}/{x}/{y}.png",{attribution:a,name:"Open Street Map Boat",minZoom:4,maxZoom:19,detectRetina:!0}),ocm:L.tileLayer("https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png",{attribution:'<a href="https://github.com/cyclosm/cyclosm-cartocss-style" target="_blank">CyclOSM</a>',name:"Open Cyclo Map",minZoom:4,maxZoom:19,detectRetina:!0}),otm:L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{attribution:a,name:"Open Topo Map",minZoom:4,maxZoom:19,detectRetina:!0}),chm:L.tileLayer("https://wmts.geo.admin.ch/1.0.0/ch.swisstopo.pixelkarte-farbe/default/current/3857/{z}/{x}/{y}.jpeg",{attribution:'<a href="https://www.swisstopo.admin.ch/" target="_blank">Swisstopo</a>',name:"Swiss Topo Map",minZoom:4,maxZoom:19,detectRetina:!0}),ggm:L.tileLayer("https://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}",{subdomains:["mt0","mt1","mt2","mt3"],attribution:s,name:"Google Map",minZoom:4,maxZoom:19,detectRetina:!0}),ggmst:L.tileLayer("httpS://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",{subdomains:["mt0","mt1","mt2","mt3"],attribution:s,name:"Google Map Sat",minZoom:4,maxZoom:19,detectRetina:!0})};for(e in(!n[self.defmap]||"ggm"===self.defmap&&-1<["yes","1",1].indexOf(navigator.doNotTrack))&&(self.defmap="osm"),self.grp=new L.featureGroup,this.createMarkers(self.data),n)n.hasOwnProperty(e)&&n[e]&&n[e].options.name&&(n[e].options.attribution+=" "+self.browser,t['<i class="hide">'+e+"</i> "+n[e].options.name]=n[e]);o=Object.keys(self.data).length,self.map=L.map("map",{layers:[n[self.defmap],self.grp],scrollWheelZoom:!0,doubleRightClickZoom:!0}),o<1?this.qs("div.main").classList.add("empty"):o>self.maxpts?self.map.setView([46.76,2.42],6):self.map.fitBounds(self.grp.getBounds(),{maxZoom:15}),this.qs(".alone")||(L.Control.Bigmap=L.Control.extend({options:{position:"topleft"},onAdd:function(e){var t=L.DomUtil.create("div","leaflet-control-fullscreen leaflet-bar leaflet-control");return this.link=L.DomUtil.create("a","leaflet-control-fullscreen-button leaflet-bar-part",t),this.link.href="",this._map=e,L.DomEvent.disableClickPropagation(this.link),L.DomEvent.on(this.link,"click",this.action,this),t},action:function(e){var t,o;L.DomEvent.stop(e),1==e.detail&&(e=shippingmax,t=this.getContainer().classList,o=e.qs(".main").classList,t.contains("leaflet-fullscreen-on")?(t.remove("leaflet-fullscreen-on"),o.remove("full-map"),(o=e.qs(".item.clicked, .item.active"))&&e.scrollToDetails(e.qs("form.results"),o)):(t.add("leaflet-fullscreen-on"),o.add("full-map")),this._map.invalidateSize())}}),self.map.addControl(new L.Control.Bigmap)),L.control.scale({imperial:!1}).addTo(self.map),L.control.layers(t).addTo(self.map),self.grp.addTo(self.map),(e=this.qs(".item.active"))&&((a=self.mkrs[e.getAttribute("id").slice(2)]).getElement().classList.add("active"),this.goToDetailsFromMarker({target:a,move:!1})),(e=this.qs(".btn-geoloc"))&&navigator.geolocation&&e.classList.remove("hide"),(e=self.parent.document.getElementById("shippingmaxBox"))&&e.classList.add("hack"),self!=self.parent&&"object"==typeof self.parent.shippingmax&&"function"==typeof self.parent.shippingmax.keyClose&&document.addEventListener("keydown",self.parent.shippingmax.keyClose)},this.geoloc=function(){var t,o,a;navigator.geolocation&&(o=(t=shippingmax).qs(".btn-geoloc span"),a=o.textContent,o.textContent="...",navigator.geolocation.getCurrentPosition(function(e){t.submitFormAjax(t.qs("form.address"),e.coords.latitude,e.coords.longitude),o.textContent=a},function(e){o.textContent=a,console.warn(e)}))},this.createMarkers=function(e){var t,o;for(t in self.mkrs={},e)e.hasOwnProperty(t)&&(o=(t=e[t]).id,(t=L.marker([t.lat,t.lng],{title:t.name,shadowUrl:null,shadowRetinaUrl:null,shadowSize:null,shadowAnchor:null}).addTo(self.grp)).on("click",shippingmax.goToDetailsFromMarker),t.on("dblclick",L.DomEvent.stop),t.superId=o,self.mkrs[o]=t);0!=self.marklat&&0!=self.marklng&&L.marker([self.marklat,self.marklng],{icon:L.icon({iconUrl:L.Icon.Default.prototype._getIconUrl().replace("undefined","ic-user-map.svg"),iconSize:[26,40],iconAnchor:[13,25],shadowUrl:null,shadowRetinaUrl:null,shadowSize:null,shadowAnchor:null,className:"userpos"})}).addTo(self.grp)},this.submitFormAjax=function(e,t,o){var a,n,i=shippingmax,l=i.showAll,r=document.getElementById("loader").classList;if(r.contains("show"))return!1;try{return r.add("show"),i.showAll?i.showAll=!1:a="number"==typeof t&&"number"==typeof o?i.serializeForm(e)+"&lat="+t+"&lng="+o+"&geoloc=1":i.serializeForm(e),-1<e.action.indexOf("update")&&(i.qs("form.results").innerHTML="",document.activeElement.blur()),n=new XMLHttpRequest,a?(n.open("POST",-1<a.indexOf("id=")?e.action+"?isAjax=true&"+a:e.action+"?isAjax=true",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded")):n.open("GET",e.action+"?isAjax=true",!0),n.onreadystatechange=function(){var e,t,o,a,s;if(4===n.readyState&&(200===n.status||0===n.status))try{(a=JSON.parse(n.responseText)).status&&a.maplist?(i.qs("form.results").innerHTML=a.maplist,self.data=a.items,self.marklat=a.lat,self.marklng=a.lng,a.country&&(t=i.qs('input[value="'+a.country.toUpperCase()+'"]'))&&((o=i.qs(".country-choice input[checked]"))&&o.removeAttribute("checked"),(o=i.qs(".country-choice input:checked"))&&(o.checked=!1),t.checked=!0,t.setAttribute("checked","checked")),(l||a.postcode)&&(document.getElementById("postcode").value=a.postcode||""),(l||a.city)&&(document.getElementById("city").value=a.city||""),self.grp.clearLayers(),0<(s=Object.keys(self.data).length)?(i.qs("div.main").classList.remove("empty"),self.map.invalidateSize(),i.createMarkers(self.data),s>self.maxpts?self.map.setView([46.76,2.42],6):self.map.fitBounds(self.grp.getBounds(),{maxZoom:15})):i.qs("div.main").classList.add("empty")):a.status?"function"==typeof self.parent.shippingmax.show?self.parent.shippingmax.show(a):(i.resetMarkers(!0),(e=self.mkrs[a.id]).getElement().classList.add("active"),self.map.setView(e.getLatLng()),document.getElementById("pt"+a.id).classList.add("active","clicked")):a.error?"refresh"===a.error?self.location.reload():alert(a.error):alert(a),r.remove("show")}catch(e){console.error(e,n.responseText),self.location.reload()}},n.send(a),!1}catch(e){console.error(e),r.remove("show")}return!0},this.serializeForm=function(e){var t=[];return Array.prototype.forEach.call(e.elements,function(e){"INPUT"===e.nodeName?-1<["checkbox","radio"].indexOf(e.getAttribute("type"))&&!e.checked||t.push(e.name+"="+encodeURIComponent(e.value)):"SELECT"===e.nodeName&&t.push(e.name+"="+encodeURIComponent(e.value))}),t.join("&")},this.goToDetailsFromMarker=function(e){var t,o,a,s,n;document.getElementById("loader").classList.contains("show")||document.activeElement&&"BUTTON"===document.activeElement.nodeName||(t=shippingmax,s=(a=(o=e.target).getElement().classList).contains("clicked"),t.resetMarkers(),s?a.remove("clicked"):(s=document.getElementById("pt"+o.superId),n=t.qs("form.results"),!1!==e.move?(a.add("clicked"),s.classList.add("clicked"),self.map.setView(o.getLatLng())):t.qs(".alone")&&(a.add("clicked"),s.classList.add("clicked")),t.scrollToDetails(n,s)))},this.goToMarkerFromDetails=function(e){var t,o;document.getElementById("loader").classList.contains("show")||document.activeElement&&"BUTTON"===document.activeElement.nodeName||(o=(t=e.classList).contains("clicked"),this.resetMarkers(),o?t.remove("clicked"):(t.add("clicked"),(o=self.mkrs[e.getAttribute("id").slice(2)]).getElement().classList.add("clicked"),self.map.setView(o.getLatLng(),15)))},this.scrollToDetails=function(e,t){var o;e.scrollHeight>e.offsetHeight&&(window.innerWidth<992||(e.scrollTop=t.offsetTop-e.offsetHeight/2+80,(o=t.getBoundingClientRect()).top<0&&o.bottom<=window.innerHeight))&&(e.scrollTop=t.offsetTop)},this.resetMarkers=function(e){document.querySelectorAll(".clicked").forEach(function(e){e.classList.remove("clicked")}),e&&document.querySelectorAll(".active").forEach(function(e){e.classList.remove("active")})},this.showSelect=function(e){e=!1!==e&&(this.show=!this.show)?"add":"remove",this.qs(".search-elements").classList[e]("country-select"),this.show="add"===e},this.updatePostcode=function(e){document.getElementById("postcode").setAttribute("type",-1<self.tel.indexOf(e.value)?"tel":"text")},this.qs=function(e){return document.querySelector(e)}};function _AutofillCallbackHandler(){}function _pcmBridgeCallbackHandler(){}"function"==typeof self.addEventListener&&(self.addEventListener("load",shippingmax.init.bind(shippingmax)),document.addEventListener("touchmove",function(e){(1!=e.scale||e.touches&&1<e.touches.length)&&e.preventDefault()},{passive:!1}));var PaymentAutofillConfig={};
//# sourceMappingURL=map.min.js.map