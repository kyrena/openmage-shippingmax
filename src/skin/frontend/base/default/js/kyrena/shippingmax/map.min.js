/*!
 * Copyright 2019-2022 | Fabrice Creuzot <fabrice~cellublue~com>
 * Copyright 2019-2022 | Mickaël Vang <mickael~cellublue~com>
 * Copyright 2019-2022 | Jérôme Siau <fabrice~cellublue~com>
 * https://github.com/kyrena/openmage-shippingmax
 * This program is free software, you can redistribute it or modify
 * it under the terms of the GNU General Public License (GPL).
 */
window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t,o){for(t=t||window,o=0;o<this.length;o++)e.call(t,this[o],o,this)});var shippingmax=new function(){"use strict";this.show=!1,this.showAll=!1,this.init=function(){console.info("shippingmax.map - hello");var e,t={},o='<a href="https://www.ign.fr/" target="_blank">IGN France</a>',a='<a href="https://www.openstreetmap.org/copyright" target="_blank">Open Street Map</a>',n='<a href="https://www.google.com/maps" target="_blank">Google</a>',i={ign:self.ignkey?L.tileLayer("https://wxs.ign.fr/"+self.ignkey+"/geoportail/wmts?&request=GetTile&service=WMTS&version=1.0.0&style=normal&tilematrixset=PM&format=image/jpeg&layer=GEOGRAPHICALGRIDSYSTEMS.MAPS&tilematrix={z}&tilerow={y}&tilecol={x}",{attribution:o,name:"IGN France",minZoom:4,maxZoom:18,tileSize:256,detectRetina:!0}):null,ignst:self.ignkey?L.tileLayer("https://wxs.ign.fr/"+self.ignkey+"/geoportail/wmts?&request=GetTile&service=WMTS&version=1.0.0&style=normal&tilematrixset=PM&format=image/jpeg&layer=ORTHOIMAGERY.ORTHOPHOTOS&tilematrix={z}&tilerow={y}&tilecol={x}",{attribution:o,name:"IGN Sat France",minZoom:4,maxZoom:18,tileSize:256,detectRetina:!0}):null,osm:L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:a,name:"Open Street Map",minZoom:4,maxZoom:18,detectRetina:!0}),osmfr:L.tileLayer("https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png",{attribution:a,name:"Open Street Map France",minZoom:4,maxZoom:18,detectRetina:!0}),osmde:L.tileLayer("https://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png",{attribution:a,name:"Open Street Map Deutschland",minZoom:4,maxZoom:18,detectRetina:!0}),osmbre:L.tileLayer("https://tile.openstreetmap.bzh/br/{z}/{x}/{y}.png",{attribution:a,name:"Open Street Map Brezhoneg",minZoom:4,maxZoom:17,detectRetina:!0}),osmoci:L.tileLayer("https://tile.openstreetmap.bzh/oc/{z}/{x}/{y}.png",{attribution:a,name:"Open Street Map Occitan",minZoom:4,maxZoom:17,detectRetina:!0}),osmeus:L.tileLayer("https://tile.openstreetmap.bzh/eu/{z}/{x}/{y}.png",{attribution:a,name:"Open Street Map Euskara",minZoom:4,maxZoom:17,detectRetina:!0}),osmbot:L.tileLayer("https://{s}.tile.openstreetmap.fr/openriverboatmap/{z}/{x}/{y}.png",{attribution:a,name:"Open Street Map Boat",minZoom:4,maxZoom:17,detectRetina:!0}),ocm:L.tileLayer("https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png",{attribution:'<a href="https://github.com/cyclosm/cyclosm-cartocss-style" target="_blank">CyclOSM</a>',name:"Open Cyclo Map",minZoom:4,maxZoom:17,detectRetina:!0}),otm:L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{attribution:a,name:"Open Topo Map",minZoom:4,maxZoom:17,detectRetina:!0}),chm:L.tileLayer("https://wmts.geo.admin.ch/1.0.0/ch.swisstopo.pixelkarte-farbe/default/current/3857/{z}/{x}/{y}.jpeg",{attribution:'<a href="https://www.swisstopo.admin.ch/" target="_blank">Swisstopo</a>',name:"Swiss Topo Map",minZoom:4,maxZoom:17,detectRetina:!0}),ggm:L.tileLayer("https://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}",{subdomains:["mt0","mt1","mt2","mt3"],attribution:n,name:"Google Map",minZoom:4,maxZoom:17,detectRetina:!0}),ggmst:L.tileLayer("httpS://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",{subdomains:["mt0","mt1","mt2","mt3"],attribution:n,name:"Google Map Sat",minZoom:4,maxZoom:17,detectRetina:!0})};for(e in(!i[self.defmap]||"ggm"===self.defmap&&-1<["yes","1",1].indexOf(navigator.doNotTrack))&&(self.defmap="osm"),self.grp=new L.featureGroup,this.createMarkers(self.data),i)i.hasOwnProperty(e)&&i[e]&&i[e].options.name&&(i[e].options.attribution+=" "+self.browser,t['<i class="hide">'+e+"</i> "+i[e].options.name]=i[e]);o=Object.keys(self.data).length,self.map=L.map("map",{layers:[i[self.defmap],self.grp],scrollWheelZoom:!0,doubleRightClickZoom:!0}),o<1?document.querySelector("div.main").classList.add("empty"):o>self.maxpts?self.map.setView([46.76,2.42],6):self.map.fitBounds(self.grp.getBounds(),{maxZoom:15}),document.querySelector(".alone")||(L.Control.Bigmap=L.Control.extend({options:{position:"topleft"},onAdd:function(e){var t=L.DomUtil.create("div","leaflet-control-fullscreen leaflet-bar leaflet-control");return this.link=L.DomUtil.create("a","leaflet-control-fullscreen-button leaflet-bar-part",t),this.link.href="",this._map=e,L.DomEvent.disableClickPropagation(this.link),L.DomEvent.on(this.link,"click",this.action,this),t},action:function(e){var t;L.DomEvent.stop(e),1<e.detail||(e=this.getContainer().classList,t=document.querySelector(".main").classList,e.contains("leaflet-fullscreen-on")?(e.remove("leaflet-fullscreen-on"),t.remove("full-map"),((t=document.querySelector(".item.clicked.active"))||(t=document.querySelector(".item.clicked"))||(t=document.querySelector(".item.active")))&&t.scrollIntoView()):(e.add("leaflet-fullscreen-on"),t.add("full-map")),this._map.invalidateSize())}}),self.map.addControl(new L.Control.Bigmap)),L.control.scale({imperial:!1}).addTo(self.map),L.control.layers(t).addTo(self.map),self.grp.addTo(self.map),(e=document.querySelector(".item.active"))&&((a=self.mkrs[e.getAttribute("id").slice(2)]).getElement().classList.add("active"),this.goToDetailFromMarker({target:a,move:!1})),(e=document.querySelector(".btn-geoloc"))&&navigator.geolocation&&e.classList.remove("hide"),(e=self.parent.document.getElementById("shippingmaxBox"))&&e.classList.add("hack"),self!=self.parent&&"function"==typeof self.parent.shippingmax.keyClose&&document.addEventListener("keydown",self.parent.shippingmax.keyClose)},this.geoloc=function(){var t,o;navigator.geolocation&&(t=document.querySelector(".btn-geoloc span"),o=t.textContent,t.textContent="...",navigator.geolocation.getCurrentPosition(function(e){shippingmax.formAjax(document.querySelector("form.address"),e.coords.latitude,e.coords.longitude),t.textContent=o},function(){t.textContent=o}))},this.createMarkers=function(e){var t,o;for(t in self.mkrs={},e)e.hasOwnProperty(t)&&(o=(t=e[t]).id,(t=L.marker([t.lat,t.lng],{title:t.name,shadowUrl:null,shadowRetinaUrl:null,shadowSize:null,shadowAnchor:null}).addTo(self.grp)).on("click",shippingmax.goToDetailFromMarker),t.on("dblclick",L.DomEvent.stop),t.superId=o,self.mkrs[o]=t);0!=self.marklat&&0!=self.marklng&&L.marker([self.marklat,self.marklng],{icon:L.icon({iconUrl:L.Icon.Default.prototype._getIconUrl().replace("undefined","ic-user-map.svg"),iconSize:[26,40],iconAnchor:[13,25],shadowUrl:null,shadowRetinaUrl:null,shadowSize:null,shadowAnchor:null,className:"userpos"})}).addTo(self.grp)},this.formAjax=function(e,t,o){var a,i=new XMLHttpRequest,s=document.getElementById("loader").classList;try{return s.contains("show")||(s.add("show"),shippingmax.showAll?shippingmax.showAll=!1:a="number"==typeof t&&"number"==typeof o?shippingmax.serialize(e)+"&lat="+t+"&lng="+o+"&geoloc=1":shippingmax.serialize(e),-1<e.action.indexOf("update")&&(document.querySelector("form.results").innerHTML="",document.activeElement.blur()),a?(i.open("POST",-1<a.indexOf("id=")?e.action+"?isAjax=true&"+a:e.action+"?isAjax=true",!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded")):i.open("GET",e.action+"?isAjax=true",!0),i.onreadystatechange=function(){var e,t,o,a,n;if(4===i.readyState&&(200===i.status||0===i.status))try{(a=JSON.parse(i.responseText)).status&&a.maplist?(document.querySelector("form.results").innerHTML=a.maplist,self.data=a.items,self.marklat=a.lat,self.marklng=a.lng,a.country&&(t=document.querySelector('input[value="'+a.country.toUpperCase()+'"]'))&&((o=document.querySelector(".country-choice input[checked]"))&&o.removeAttribute("checked"),(o=document.querySelector(".country-choice input:checked"))&&(o.checked=!1),t.checked=!0,t.setAttribute("checked","checked")),a.postcode&&(document.getElementById("postcode").value=a.postcode),a.city&&(document.getElementById("city").value=a.city),self.grp.clearLayers(),0<(n=Object.keys(self.data).length)?(document.querySelector("div.main").classList.remove("empty"),self.map.invalidateSize(),shippingmax.createMarkers(self.data),n>self.maxpts?self.map.setView([46.76,2.42],6):self.map.fitBounds(self.grp.getBounds(),{maxZoom:15})):document.querySelector("div.main").classList.add("empty")):a.status?"function"==typeof self.parent.shippingmax.show?self.parent.shippingmax.show(a):(shippingmax.reset(!0),(e=self.mkrs[a.id]).getElement().classList.add("active"),self.map.setView(e.getLatLng()),document.getElementById("pt"+a.id).classList.add("active","clicked")):a.error?"refresh"===a.error?self.location.reload():alert(a.error):alert(a),s.remove("show")}catch(e){console.error(e,i.responseText),self.location.reload()}},i.send(a)),!1}catch(e){console.error(e),s.remove("show")}return!0},this.serialize=function(e){var t=[];return Array.prototype.forEach.call(e.elements,function(e){"INPUT"===e.nodeName?-1<["checkbox","radio"].indexOf(e.getAttribute("type"))&&!e.checked||t.push(e.name+"="+encodeURIComponent(e.value)):"SELECT"===e.nodeName&&t.push(e.name+"="+encodeURIComponent(e.value))}),t.join("&")},this.goToDetailFromMarker=function(e){var t,o,a,n;document.activeElement&&"BUTTON"===document.activeElement.nodeName||(a=(o=(t=e.target).getElement().classList).contains("clicked"),shippingmax.reset(),a?o.remove("clicked"):(a=document.getElementById("pt"+t.superId),n=document.querySelector("form.results"),!1!==e.move?(o.add("clicked"),a.classList.add("clicked"),self.map.setView(t.getLatLng())):document.querySelector(".alone")&&(o.add("clicked"),a.classList.add("clicked")),n.scrollHeight>n.offsetHeight&&(window.innerWidth<992?n.scrollTop=a.offsetTop:(n.scrollTop=a.offsetTop-n.offsetHeight/2+80,(e=a.getBoundingClientRect()).top<0&&e.bottom<=window.innerHeight&&(n.scrollTop=a.offsetTop)))))},this.goToMarkerFromDetail=function(e){var t,o;document.activeElement&&"BUTTON"===document.activeElement.nodeName||(o=(t=e.classList).contains("clicked"),this.reset(),o?t.remove("clicked"):(t.add("clicked"),(o=self.mkrs[e.getAttribute("id").slice(2)]).getElement().classList.add("clicked"),self.map.setView(o.getLatLng(),15)))},this.reset=function(e){document.querySelectorAll(".clicked").forEach(function(e){e.classList.remove("clicked")}),e&&document.querySelectorAll(".active").forEach(function(e){e.classList.remove("active")})},this.showSelect=function(e){e=!1!==e&&(this.show=!this.show)?"add":"remove",document.querySelector(".search-elements").classList[e]("country-select"),this.show="add"===e},this.updatePostcode=function(e){document.getElementById("postcode").setAttribute("type",-1<self.tel.indexOf(e.value)?"tel":"text")}};function _AutofillCallbackHandler(){}function _pcmBridgeCallbackHandler(){}"function"==typeof self.addEventListener&&self.addEventListener("load",shippingmax.init.bind(shippingmax));var PaymentAutofillConfig={};
//# sourceMappingURL=map.min.js.map